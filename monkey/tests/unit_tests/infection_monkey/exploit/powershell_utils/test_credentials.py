from infection_monkey.exploit.powershell_utils.credentials import Credentials, get_credentials

TEST_USERNAMES = ["user1", "user2"]
TEST_PASSWORDS = ["p1", "p2"]


def test_get_credentials__empty_windows_true():
    credentials = get_credentials([], [], True)

    assert len(credentials) == 1
    assert credentials[0] == Credentials(username=None, secret=None)


def test_get_credentials__empty_windows_false():
    credentials = get_credentials([], [], False)

    assert len(credentials) == 0


def test_get_credentials__username_only_windows_true():
    credentials = get_credentials(TEST_USERNAMES, [], True)

    assert len(credentials) == 5
    assert Credentials(username=TEST_USERNAMES[0], secret="") in credentials
    assert Credentials(username=TEST_USERNAMES[1], secret="") in credentials
    assert Credentials(username=TEST_USERNAMES[0], secret=None) in credentials
    assert Credentials(username=TEST_USERNAMES[1], secret=None) in credentials


def test_get_credentials__username_only_windows_false():
    credentials = get_credentials(TEST_USERNAMES, [], False)

    assert len(credentials) == 2
    assert Credentials(username=TEST_USERNAMES[0], secret="") in credentials
    assert Credentials(username=TEST_USERNAMES[1], secret="") in credentials


def test_get_credentials__username_password_windows_true():
    credentials = get_credentials(TEST_USERNAMES, TEST_PASSWORDS, True)

    assert len(credentials) == 9
    for user in TEST_USERNAMES:
        for password in TEST_PASSWORDS:
            assert Credentials(username=user, secret=password) in credentials
