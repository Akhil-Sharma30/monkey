#!/bin/bash

umask 077
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd)
GID=$(id -g)
TAG="latest"

DOCKER_COMMANDS="
cd /plugin &&
bash build_plugin.sh &&
chown ${UID}:${GID} \"/plugin/Hadoop-exploiter.tar\"
"

docker pull infectionmonkey/agent-builder:$TAG
docker run \
    --rm \
    -v "$SCRIPT_DIR:/plugin" \
    infectionmonkey/agent-builder:$TAG \
    /bin/bash -c "$DOCKER_COMMANDS" | ts  '[%Y-%m-%d %H:%M:%S]'
