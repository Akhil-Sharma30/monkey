import _ from 'lodash';
import React from 'react';
import MapNode from '../../types/MapNode';
import {OverlayTrigger, Tooltip} from 'react-bootstrap';
import {FontAwesomeIcon} from '@fortawesome/react-fontawesome';
import {faQuestionCircle} from '@fortawesome/free-solid-svg-icons/faQuestionCircle';


const ExploitionTimeline = (props: {asset: MapNode}) => {
  if (props.asset.exploitationAttempts.length === 0) {
    return (<div/>);
  }

  return (
    <div className={'exploit-timeline'}>
      <h4 style={{'marginTop': '2em'}}>
        Exploit Timeline&nbsp;
        {generateToolTip('Timeline of exploit attempts. Red is successful. Gray is unsuccessful')}
      </h4>
      <ul className='timeline'>
        {_.sortBy(props.asset.exploitationAttempts, 'timestamp').map(attempt =>
          <li key={attempt.timestamp}>
            <div className={'bullet ' + (attempt.success ? 'bad' : '')}/>
            <div>{new Date(attempt.timestamp).toLocaleString()}</div>
            <div>{attempt.source}</div>
            <div>{attempt.exploiter_name}</div>
          </li>
        )}
      </ul>
    </div>
  )
}

function generateToolTip(text) {
  return (
    <OverlayTrigger placement="top"
                    overlay={<Tooltip id="tooltip">{text}</Tooltip>}
                    delay={{show: 250, hide: 400}}>
      <a><FontAwesomeIcon icon={faQuestionCircle} style={{'marginRight': '0.5em'}}/></a>
    </OverlayTrigger>
  );
}

export default ExploitionTimeline
